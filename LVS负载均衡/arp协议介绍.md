ARP协议介绍
====================
**什么是ARP协议**

>ARP协议全称"Address Resolution Protocol",中文名`地址解析协议`，使用ARP协议可以通过`IP地址获得对应的主机的物理地址(MAC地址)`

>在TCP/IP的网络环境下，每个联网主机都会被分配一个32位的IP地址，这种互联网地址在国际范围表示主机的一种逻辑地址。为了让报文在物理网络上传输，还必须知道对方的物理地址(MAC)才行，这样就存在把IP地址变换成物理地址的地址转换问题

>以以太网环境为例说明,为了正确地向目的主机传送报文，必须把目的主机的32位IP地址转换成目标主机48位以太网地址(MAC地址)，这个服务就是ARP协议。

>所谓的`地址解析`，就是主机在发送帧之前将目标IP地址转换成目标mac地址的过程。ARP协议基本功能就是通过目标设备的IP地址，查询目标设备的MAC地址以保障主机之间互相通信的顺利进行。

**ARP协议和DNS协议有点相似之处，不同点是:DNS是在域名和IP之间解析，另外ARP协议不需要配置服务，而DNS要配置服务器才行。**

**ARP协议要求通信主机双方必须在同一物理网段(即局域网环境)**

arp -a 查看arp缓存表

* arp缓存表是把双刃剑
    - 有arp缓存表可以加快app的解析速度(减少广播风暴)。
    - 正是有了arp缓存表，给恶意黑客带来了攻击服务器主机的风险，这就是著名的arp欺骗或者arp攻击

#####为什么要使用ARP协议:

>OSI七层协议把网络工作分为7层，彼此不打交道。IP地址工作在第三层，MAC地址工作在第二层。当协议发送数据包时，需要先封装第三层(IP地址层)，第二层(MAC地址)的报文但协议只知道目的节点的IP地址，不知道其MAC地址，又不能跨第二、三层，所以得用ARP协议服务。

ARP是第三层协议


**ARP在生产环境产生的问题和解决方法：**

* ARP病毒，ARP欺骗
* 高可用服务器对切换时要考虑ARP缓存问题
* 路由器等设备无缝迁移时要考虑ARP缓存问题，例如:换办公室的路由器

**服务器切换ARP问题**

>当网络中一台提供服务的机器宕机后，当其他运行正常的机器添加宕机的机器IP时，会因为客户端的ARP table cache的地址解析还是宕机的机器的MAC地址。从而导致几十运行其他正常的机器添加宕机的机器的IP，也会发生客户无法访问的情况

>解决方法是：当机器宕机，IP地址迁移到其他机器上时，需要通过arping命令来通知所有网络内机器清除自己本地的ARP table cache 从而使得客户机访问时重新广播获取MAC地址。这是在开发脚本实现服务器的高可用时必须要考虑的问题之一。

ARP广播而进行新的解析:
具体命令
```
/sbin/arping -I eth0 -c 3 -s 10.0.0.162 10.0.253
/sbin/arping -I eth0 10.0.0.162
```